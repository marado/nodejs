#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/upstream-tarball.mk
include /usr/share/cdbs/1/rules/utils.mk
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/cmake.mk

DEB_UPSTREAM_URL = http://nodejs.org/dist/v$(DEB_UPSTREAM_TARBALL_VERSION)/
DEB_UPSTREAM_TARBALL_BASENAME = node-v$(DEB_UPSTREAM_TARBALL_VERSION)

# suppress checking binary files, to not upset dpkg-source
DEB_COPYRIGHT_CHECK_IGNORE_REGEX = ^(doc/trademark-policy\.pdf|doc/joyent-logo_orange_nodeorg-01\.png|doc/logos/.*\.png|debian/(changelog|copyright(|_hints|_newhints)))$

DEB_CMAKE_EXTRA_FLAGS = -DSHARED_V8=True -DSHARED_LIBEV=True -DSHARED_CARES=True
DEB_DESTDIR = $(CURDIR)/debian/tmp

#  * relax regression tests when targeted experimental suite
exp-relax-check := $(if $(shell dpkg-parsechangelog | grep -Fx 'Distribution: experimental'),-i)
DEB_MAKE_CHECK_TARGET = $(exp-relax-check) test

# we have completion for nodejs-waf
install/nodejs-dev::
       dh_bash-completion

# rename and install binary in nodejs-dbg
#install/nodejs-dbg::
	#mv $(CURDIR)/debian/tmp/usr/bin/node_g $(CURDIR)/debian/nodejs-dbg/usr/lib/debug/usr/bin/node
